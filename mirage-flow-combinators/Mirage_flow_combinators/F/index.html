<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>F (mirage-flow-combinators.Mirage_flow_combinators.F)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.3.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">mirage-flow-combinators</a> &#x00BB; <a href="../index.html">Mirage_flow_combinators</a> &#x00BB; F</nav><header class="odoc-preamble"><h1>Module <code><span>Mirage_flow_combinators.F</span></code></h1><p>In-memory, function-based flows.</p></header><nav class="odoc-toc"><ul><li><a href="#string-flows">String flows</a></li><li><a href="#cstruct-buffers-flows">Cstruct buffers flows</a></li></ul></nav><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../mirage-flow/Mirage_flow/module-type-S/index.html">Mirage_flow.S</a></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span></code></div><div class="spec-doc"><p>The type for flow errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><a href="#type-error">error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_error</code> is the pretty-printer for errors.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-write_error"><a href="#type-write_error" class="anchor"></a><code><span><span class="keyword">type</span> <span class="keyword">nonrec</span> write_error</span><span> = <span class="keyword">private</span> </span><span>[&gt; </span></code><ol><li id="type-write_error.Mirage_flow.write_error" class="def type anchored"><a href="#type-write_error.Mirage_flow.write_error" class="anchor"></a><code><span>| </span></code><code><span><a href="../../../mirage-flow/Mirage_flow/index.html#type-write_error">Mirage_flow.write_error</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for write errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_write_error"><a href="#val-pp_write_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_write_error : <span><a href="#type-write_error">write_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_write_error</code> is the pretty-printer for write errors.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-flow"><a href="#type-flow" class="anchor"></a><code><span><span class="keyword">type</span> flow</span></code></div><div class="spec-doc"><p>The type for flows. A flow represents the state of a single reliable stream that is connected to an endpoint.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span><span class="xref-unresolved">Cstruct</span>.t <a href="../../../mirage-flow/Mirage_flow/index.html#type-or_eof">Mirage_flow.or_eof</a></span>, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read flow</code> blocks until some data is available and returns a fresh buffer containing it.</p><p>The returned buffer will be of a size convenient to the flow implementation, but will always have at least 1 byte.</p><p>If the remote endpoint calls <code>close</code> then calls to <code>read</code> will keep returning data until all the in-flight data has been read. <code>read flow</code> will return <code>`Eof</code> when the remote endpoint has called <code>close</code> and when there is no more in-flight data.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>write flow buffer</code> writes a buffer to the flow. There is no indication when the buffer has actually been read and, therefore, it must not be reused. The contents may be transmitted in separate packets, depending on the underlying transport. The result <code>Ok ()</code> indicates success, <code>Error `Closed</code> indicates that the connection is now closed and therefore the data could not be written. Other errors are possible.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-writev"><a href="#val-writev" class="anchor"></a><code><span><span class="keyword">val</span> writev : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>writev flow buffers</code> writes a sequence of buffers to the flow. There is no indication when the buffers have actually been read and, therefore, they must not be reused. The result <code>Ok ()</code> indicates success, <code>Error `Closed</code> indicates that the connection is now closed and therefore the data could not be written. Other errors are possible.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `read <span>| `write</span> <span>| `read_write</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>shutdown flow mode</code> shuts down the <code>flow</code> for the specific <code>mode</code>: A flow which is <code>shutdown `read</code> (or <code>`read_write</code> will never be <code>read</code> again (future calls will return <code>`Eof</code>); a flow which is <code>shutdown `write</code> (or <code>`read_write</code>) flushes all pending writes and signals the remote endpoint there won't be any future <code>write</code>. In TCP, a FIN is sent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>close flow</code> terminates the <code>flow</code> and frees all associated data. Any subsequent <code>read</code> or <code>write</code> will return an error. A subsequent <code>close</code> will not do anything (esp. not raising an exception), but it may log an error.</p></div></div></details></div><div class="odoc-spec"><div class="spec type anchored" id="type-refill"><a href="#type-refill" class="anchor"></a><code><span><span class="keyword">type</span> refill</span><span> = <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>The type for refill functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?close</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?input</span>:<a href="#type-refill">refill</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?output</span>:<a href="#type-refill">refill</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-flow">flow</a></span></code></div><div class="spec-doc"><p><code>make ~close ~input ~output ()</code> is a flow using <code>input</code> to refill its internal input buffer when needed and <code>output</code> to refill its external output buffer. It is using <code>close</code> to eventually clean-up other resources on close.</p></div></div><h2 id="string-flows"><a href="#string-flows" class="anchor"></a>String flows</h2><div class="odoc-spec"><div class="spec value anchored" id="val-input_string"><a href="#val-input_string" class="anchor"></a><code><span><span class="keyword">val</span> input_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p><code>input_string buf</code> is the refill function reading its inputs from the string <code>buf</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_bytes"><a href="#val-output_bytes" class="anchor"></a><code><span><span class="keyword">val</span> output_bytes : <span>bytes <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p><code>output_bytes buf</code> is the refill function writing its outputs in the buffer <code>buf</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span><span class="optlabel">?input</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?output</span>:bytes <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-flow">flow</a></span></code></div><div class="spec-doc"><p>The flow built using <a href="#val-input_string"><code>input_string</code></a> and <a href="#val-output_bytes"><code>output_bytes</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-input_strings"><a href="#val-input_strings" class="anchor"></a><code><span><span class="keyword">val</span> input_strings : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p><code>input_strings bufs</code> is the refill function reading its inputs from the list of buffers <code>bufs</code>. Empty strings are ignored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_bytess"><a href="#val-output_bytess" class="anchor"></a><code><span><span class="keyword">val</span> output_bytess : <span><span>bytes list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p><code>output_bytess buf</code> is the refill function writing its outputs in the list of buffers <code>buf</code>. Empty strings are ignored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-strings"><a href="#val-strings" class="anchor"></a><code><span><span class="keyword">val</span> strings : <span><span class="optlabel">?input</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?output</span>:<span>bytes list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-flow">flow</a></span></code></div><div class="spec-doc"><p>The flow built using <a href="#val-input_strings"><code>input_strings</code></a> and <a href="#val-output_bytess"><code>output_bytess</code></a>.</p></div></div><h2 id="cstruct-buffers-flows"><a href="#cstruct-buffers-flows" class="anchor"></a>Cstruct buffers flows</h2><div class="odoc-spec"><div class="spec value anchored" id="val-input_cstruct"><a href="#val-input_cstruct" class="anchor"></a><code><span><span class="keyword">val</span> input_cstruct : <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-input_string"><code>input_string</code></a> but for <code>Cstruct.t</code> buffers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_cstruct"><a href="#val-output_cstruct" class="anchor"></a><code><span><span class="keyword">val</span> output_cstruct : <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p>Same as <code>output_string</code> buf for <code>Cstruct.t</code> buffers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cstruct"><a href="#val-cstruct" class="anchor"></a><code><span><span class="keyword">val</span> cstruct : <span><span class="optlabel">?input</span>:<span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?output</span>:<span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-flow">flow</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-string"><code>string</code></a> but for <code>Cstruct.t</code> buffers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-input_cstructs"><a href="#val-input_cstructs" class="anchor"></a><code><span><span class="keyword">val</span> input_cstructs : <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-input_strings"><code>input_strings</code></a> but for <code>Cstruct.t</code> buffers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_cstructs"><a href="#val-output_cstructs" class="anchor"></a><code><span><span class="keyword">val</span> output_cstructs : <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-refill">refill</a></span></code></div><div class="spec-doc"><p>Same as <code>output_strings</code> but for <code>Cstruct.t</code> buffers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cstructs"><a href="#val-cstructs" class="anchor"></a><code><span><span class="keyword">val</span> cstructs : <span><span class="optlabel">?input</span>:<span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?output</span>:<span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-flow">flow</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-strings"><code>strings</code></a> but for <code>Cstruct.t</code> buffers.</p></div></div></div></body></html>
